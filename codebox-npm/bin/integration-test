#!/bin/bash

NODE_TAG=$1

docker build \
--rm=false \
--build-arg sls_version=1.6.1 \
-t codebox-npm-node-$NODE_TAG \
-q \
-f ./integration/Dockerfile-$NODE_TAG .

docker run \
-e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
-e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} \
-e CODEBOX_REGION=${CODEBOX_REGION} \
-e CODEBOX_ADMINS=${CODEBOX_ADMINS} \
-e CODEBOX_REGISTRY=${CODEBOX_REGISTRY} \
-e CODEBOX_BUCKET=${CODEBOX_BUCKET} \
-e CODEBOX_GITHUB_URL=${CODEBOX_GITHUB_URL} \
-e CODEBOX_GITHUB_CLIENT_ID=${CODEBOX_GITHUB_CLIENT_ID} \
-e CODEBOX_GITHUB_SECRET=${CODEBOCODEBOX_GITHUB_SECRET} \
-e NPM_LOGIN_TOKEN=${NPM_LOGIN_TOKEN} \
-e CIRCLE_SHA1=${CIRCLE_SHA1} \
-e CIRCLE_NODE_INDEX=${CIRCLE_NODE_INDEX} \
-it \
--rm=false \
--name codebox-npm-node-$NODE_TAG codebox-npm-node-$NODE_TAG
